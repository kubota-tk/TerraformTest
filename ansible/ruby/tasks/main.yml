---
# tasks file for ruby
- name: Check if ruby is installed
  command:
    cmd: ruby --version
  register: ruby_check
  ignore_errors: true
  changed_when: false

- name: 'Install rbenv'
  git:
    repo: https://github.com/sstephenson/rbenv.git
    dest: ~/.rbenv
  shell: echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bash_profile
  shell: echo 'eval "$(rbenv init -)"' >> ~/.bash_profile
  shell: source ~/.bash_profile
  when: ruby_check.failed

- name: 'Install ruby-build'
  git:
    repo: https://github.com/sstephenson/ruby-build.git
    dest: ~/.rbenv/plugins/ruby-build
  shell: sudo ./install.sh
  when: ruby_check.failed

- name: 'rubyインストール'
  shell: rbenv install 3.2.3 -v
  shell: rbenv global 3.2.3
  when: ruby_check.failed
